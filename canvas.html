<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>canvas</title>
	
	<style type="text/css" media="screen">
		body {
			font-family: 'Helvetica Neue', Arial, sans-serif;
			padding: 0px 40px;
		}
		
		h1 {
			font-weight: 100;
		}
		
		#cnvs {
            border: 1px solid #CCC;
		}
		
		td {
		    border: 1px solid #CCC;
		}
		
	</style>
	
	<script type="text/javascript" src="_base/js/jquery-1.3.2.min.js" charset="utf-8"></script>
	
	<script type="text/javascript" charset="utf-8">
	

	    var placePoints = [15,12,10,8,7,6,5,4,3,2,1,0]
	    
	    var raceCount = 10;
	    var playerCount = 4;
	
		$(function(){
		    var playerPoints = []
		    for (i=1; i <= playerCount; i++) {
    	        row = $('<tr />');
    	        cells = '';
    	        playerPoints[i] = [];
    	        for (j=1; j <= raceCount; j++ ) {
    	            var place = Math.ceil( Math.random() * 12)
    	            var points = placePoints[place-1];
    	            cells += '<td>'+points+'</td>';
                    playerPoints[i][j] = points;
    	        }
    	        row.append( cells );
    	        
    	        $('table').append(row);
    	    }

            function drawCanvas() {
    			var canvas = document.getElementById("cnvs");
    			if (canvas.getContext) {
    				var ctx = canvas.getContext("2d");
    				// begin canvas code

                    var meterH = 20;
                    var marginY = 60;
                    var handleY = (marginY-meterH)/2;

                    var x = [];


                    ctx.lineWidth = 3;


                    /*
                    for(var j=1; j <= playerPoints[1].length; j++ ) {
                        // ctx.fillRect(j*40,250,10,10);
                        var hue = (360 / playerPoints[1].length) * j;
                        hue = parseInt(hue);
                        ctx.strokeStyle = 'hsl('+hue+',100%, 80%)';
                        
                        var curveHandle = marginY/2;
                        
                        
                        var x1 = (j-0)*40+.5;
                        var cpx1 = x1;
                        
                        var y1 = 0;
                        var cpy1 = y1 + curveHandle;

                        var x2 = x1 + 40;
                        var cpx2 = x2;
                        
                        var y2 = y1 + marginY;
                        var cpy2 = y2 - curveHandle;
                        
                        ctx.beginPath();
                            ctx.moveTo( x1, y1);
                            // ctx.lineTo( x2, y2);
                            ctx.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, x2, y2);
                            ctx.stroke();
                        ctx.closePath();
                    }
                    */

                    /*
                    x[1] = 0;
                    for(var j=1; j <= raceCount; j++ ) {
                        var hue = (360 / raceCount) * j;
                        hue = parseInt(hue);
                        ctx.strokeStyle = 'hsl('+hue+',100%, 80%)';
                        
                        var handleY = (marginY-meterH)/2;

                        var points = playerPoints[1][j] * 4;
                        
                        var x1 = x[1] + points + 1.5;
                        var y1 = 0;
                        
                        ctx.beginPath();
                            ctx.moveTo( x1, y1);

                            for (i=2; i <= playerCount; i++ ) {
                                
                                var x2 = x[i-1];
                                var y2 = y1 + meterH + marginY * (i-2);
                                
                                var cpx2 = x2;
                                var cpy2 = y2 + handleY;
                                
                                var x3 = 
                                
                                ctx.lineTo(x2,y2);
                                
                                // ctx.lineTo()
                            }
                            // ctx.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, x2, y2);
                            ctx.stroke();
                        ctx.closePath();
                        
                        x[1] += points;
                    }
                    */

                    /*
                    var x = [];
                    for (var i=1; i < playerPoints.length; i++) {
                        x[i] = 0;
                        for (var j=1; j < playerPoints[i].length; j++) {
                            var points = playerPoints[i][j] * 4;

                            var hue = (360 / playerPoints[i].length) * j;
                            hue = parseInt(hue);
                            ctx.fillStyle = 'hsl('+hue+',100%, 50%)';

                            ctx.fillRect (x[i] + points, marginY * (i-1), 3, meterH);



                            x[i] += points;
                        }
                    }
                    */

                    for (i=1; i <= playerCount; i++) {
                        x[i] = 0;
                    }

                    for ( j=1; j <= raceCount; j++) {
                        var hue = (360 / raceCount) * j;
                        hue = parseInt(hue);
                        ctx.strokeStyle = 'hsla('+hue+',100%, 50%, .8)';

                        var player1points = playerPoints[1][j] * 4;

                        var x1 = x[1] + player1points + 1.5;
                        var y1 = 0;

                        ctx.beginPath();
                            ctx.moveTo(x1,y1);

                            for (i=2; i <= playerCount; i++) {
                                var points = playerPoints[i][j] * 4;

                                var x2 = x[i] + points + 1.5;
                                var y2 = marginY*(i-1);

                                ctx.lineTo(x2,y2);

                                x[i] += points;
                            }

                            ctx.stroke();
                        ctx.closePath();

                        x[1] += player1points;
                        
                    }

                    

                    for (i=1; i <= playerCount; i++) {
                        x[i] = 0;
                    }

                    for ( j=1; j <= raceCount; j++) {
                        var hue = (360 / raceCount) * j;
                        hue = parseInt(hue);
                        ctx.strokeStyle = 'hsla('+hue+',100%, 50%, .3)';

                        for (i=1; i <= playerCount; i++) {
                            var points = playerPoints[i][j] * 4;

                            var x1 = x[i] + points + 1.5;
                            var y1 = marginY*(i-1);

                            var x2 = x1;
                            var y2 = y1 + meterH;

                            ctx.beginPath();
                                ctx.moveTo(x1,y1);
                                ctx.lineTo(x2,y2);
                                ctx.stroke();
                            ctx.closePath();

                            x[i] += points;
                        }

                    }


    			}
    		}



		    drawCanvas();
		})
		
		
	</script>
	
</head>

<body>

	<h1>canvas</h1>
	
	<canvas id="cnvs" width="600" height="400"></canvas>
    
    <table>
        
    </table>

</body>
</html>